Well, writing this _correctly_ was harder than it seems.

You need to be very careful between looking at the character in
the buffer (peeking) and actually extracting it.

Also receive buffer size. You typed long string in arduino-cli
monitor. 100 characters! You pressed Enter. What will happen?

UART transmission is like blinking flashlight. When you missed it, you
missed it.

That 100 bytes is blinked to RX pin, usually 10 bits per bit, 5.76 ms
per byte if baud is 57600. Half a second for hundred bytes.

If your sketch is scratching balls this time, string will go to Serial
buffer which is 64 bytes and fill it (if it was empty lol).
  Your mileage may vary if you change SERIAL_RX_BUFFER_SIZE in
  [HardwareSerial.h]. But it won't change general principle.
Remaining 36 bytes will be discarded.

If your sketch is processing bytes slower than it receives it, buffer
will overflow again. But just later. I hope you wasn't parsing
context-specific grammars.

If your sketch processing bytes faster than it receives it (< 5.76 ms
per byte), we will continue talking.


So you are catching every byte and immediately start processing it?
Bad idea. Data starving. You will get phantom stream ends in a middle
or your parsing. (Stream.available() == 0) but stream.read() succeeds
later in the code? That's it. Wait some time. Like 50 ms. Smoke
cigarette maybe.

You want a condition when data packet is transferred and new packet
transmission has not started. That's why packet size should be less
than buffer size (64 bytes for typical Uno firmware).


Your data depends on your project. Your protocol depends on your
project and your data.

"120". 18 ms to transfer. How long it will take to apply that "120"?
Do you need feedback? What is your typical commands?

How would you transfer 180 bytes (in decimal ASCII)? (For 60 LEDS of
RGB stripe, which is just 1 meter and takes 2 ms to send it to LED
controller.)


Communication is not free in real world. Finding good balance between
responsiveness and reliability is your job.

-- Martin, 2024-05-08
